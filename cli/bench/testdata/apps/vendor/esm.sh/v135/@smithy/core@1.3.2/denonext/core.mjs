/* esm.sh - esbuild bundle(@smithy/core@1.3.2) denonext production */
import"/v135/@smithy/types@2.9.1/denonext/types.mjs";import{getSmithyContext as v}from"/v135/@smithy/util-middleware@2.1.1/denonext/util-middleware.mjs";function E(t){let e=new Map;for(let r of t)e.set(r.schemeId,r);return e}var u=(t,e)=>(r,o)=>async n=>{let a=t.httpAuthSchemeProvider(await e.httpAuthSchemeParametersProvider(t,o,n.input)),s=E(t.httpAuthSchemes),h=v(o),p=[];for(let i of a){let c=s.get(i.schemeId);if(!c){p.push(`HttpAuthScheme \`${i.schemeId}\` was not enabled for this service.`);continue}let d=c.identityProvider(await e.identityProviderConfigProvider(t));if(!d){p.push(`HttpAuthScheme \`${i.schemeId}\` did not have an IdentityProvider configured.`);continue}let{identityProperties:m={},signingProperties:M={}}=i.propertiesExtractor?.(t,o)||{};i.identityProperties=Object.assign(i.identityProperties||{},m),i.signingProperties=Object.assign(i.signingProperties||{},M),h.selectedHttpAuthScheme={httpAuthOption:i,identity:await d(i.identityProperties),signer:c.signer};break}if(!h.selectedHttpAuthScheme)throw new Error(p.join(`
`));return r(n)};import{endpointMiddlewareOptions as T}from"/v135/@smithy/middleware-endpoint@2.4.1/denonext/middleware-endpoint.mjs";var A={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:T.name},Q=(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:r})=>({applyToStack:o=>{o.addRelativeTo(u(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:r}),A)}});import{serializerMiddlewareOption as H}from"/v135/@smithy/middleware-serde@2.1.1/denonext/middleware-serde.mjs";var q={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:H.name},V=(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:r})=>({applyToStack:o=>{o.addRelativeTo(u(t,{httpAuthSchemeParametersProvider:e,identityProviderConfigProvider:r}),q)}});import{HttpRequest as b}from"/v135/@smithy/protocol-http@3.1.1/denonext/protocol-http.mjs";import"/v135/@smithy/types@2.9.1/denonext/types.mjs";import{getSmithyContext as I}from"/v135/@smithy/util-middleware@2.1.1/denonext/util-middleware.mjs";var R=t=>e=>{throw e},k=(t,e)=>{},f=t=>(e,r)=>async o=>{if(!b.isInstance(o.request))return e(o);let a=I(r).selectedHttpAuthScheme;if(!a)throw new Error("No HttpAuthScheme was selected: unable to sign request");let{httpAuthOption:{signingProperties:s={}},identity:h,signer:p}=a,i=await e({...o,request:await p.sign(o.request,h,s)}).catch((p.errorHandler||R)(s));return(p.successHandler||k)(i.response,s),i};import{retryMiddlewareOptions as O}from"/v135/@smithy/middleware-retry@2.1.1/denonext/middleware-retry.mjs";var K={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:O.name},de=t=>({applyToStack:e=>{e.addRelativeTo(f(t),K)}});var w=class{constructor(e){this.authSchemes=new Map;for(let[r,o]of Object.entries(e))o!==void 0&&this.authSchemes.set(r,o)}getIdentityProvider(e){return this.authSchemes.get(e)}};import{HttpApiKeyAuthLocation as y}from"/v135/@smithy/types@2.9.1/denonext/types.mjs";var x=class{async sign(e,r,o){if(!o)throw new Error("request could not be signed with `apiKey` since the `name` and `in` signer properties are missing");if(!o.name)throw new Error("request could not be signed with `apiKey` since the `name` signer property is missing");if(!o.in)throw new Error("request could not be signed with `apiKey` since the `in` signer property is missing");if(!r.apiKey)throw new Error("request could not be signed with `apiKey` since the `apiKey` is not defined");let n=e.clone();if(o.in===y.QUERY)n.query[o.name]=r.apiKey;else if(o.in===y.HEADER)n.headers[o.name]=o.scheme?`${o.scheme} ${r.apiKey}`:r.apiKey;else throw new Error("request can only be signed with `apiKey` locations `query` or `header`, but found: `"+o.in+"`");return n}};var S=class{async sign(e,r,o){let n=e.clone();if(!r.token)throw new Error("request could not be signed with `token` since the `token` is not defined");return n.headers.Authorization=`Bearer ${r.token}`,n}};var g=class{async sign(e,r,o){return e}};var _=t=>e=>C(e)&&e.expiration.getTime()-Date.now()<t,Te=3e5,Ae=_(3e5),C=t=>t.expiration!==void 0,He=(t,e,r)=>{if(t===void 0)return;let o=typeof t!="function"?async()=>Promise.resolve(t):t,n,a,s,h=!1,p=async i=>{a||(a=o(i));try{n=await a,s=!0,h=!1}finally{a=void 0}return n};return e===void 0?async i=>((!s||i?.forceRefresh)&&(n=await p(i)),n):async i=>((!s||i?.forceRefresh)&&(n=await p(i)),h?n:r(n)?(e(n)&&await p(i),n):(h=!0,n))};import{SMITHY_CONTEXT_KEY as P}from"/v135/@smithy/types@2.9.1/denonext/types.mjs";var Ke=t=>t[P]||(t[P]={});var Ce=t=>{if(typeof t=="function")return t;let e=Promise.resolve(t);return()=>e};import{HttpRequest as z}from"/v135/@smithy/protocol-http@3.1.1/denonext/protocol-http.mjs";import{resolvedPath as Y}from"/v135/@smithy/smithy-client@2.3.1/denonext/smithy-client.mjs";function Ne(t,e){return new l(t,e)}var l=class{constructor(e,r){this.input=e,this.context=r,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){let{hostname:e,protocol:r="https",port:o,path:n}=await this.context.endpoint();this.path=n;for(let a of this.resolvePathStack)a(this.path);return new z({protocol:r,hostname:this.hostname||e,port:o,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push(r=>{this.path=`${r?.endsWith("/")?r.slice(0,-1):r||""}`+e}),this}p(e,r,o,n){return this.resolvePathStack.push(a=>{this.path=Y(a,this.input,e,r,o,n)}),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}};var $=async(t,e,r,...o)=>await e.send(new t(r),...o);function N(t,e,r,o,n){return async function*(s,h,...p){let i=s.startingToken||void 0,c=!0,d;for(;c;){if(h[r]=i,n&&(h[n]=h[n]??s.pageSize),s.client instanceof t)d=await $(e,s.client,h,...p);else throw new Error(`Invalid client, expected instance of ${t.name}`);yield d;let m=i;i=j(d,o),c=!!(i&&(!s.stopOnSameToken||i!==m))}return void 0}}var j=(t,e)=>{let r=t,o=e.split(".");for(let n of o){if(!r||typeof r!="object")return;r=r[n]}return r};export{w as DefaultIdentityProviderConfig,Te as EXPIRATION_MS,x as HttpApiKeyAuthSigner,S as HttpBearerAuthSigner,g as NoAuthSigner,l as RequestBuilder,_ as createIsIdentityExpiredFunction,N as createPaginator,C as doesIdentityRequireRefresh,Q as getHttpAuthSchemeEndpointRuleSetPlugin,V as getHttpAuthSchemePlugin,de as getHttpSigningPlugin,Ke as getSmithyContext,A as httpAuthSchemeEndpointRuleSetMiddlewareOptions,u as httpAuthSchemeMiddleware,q as httpAuthSchemeMiddlewareOptions,f as httpSigningMiddleware,K as httpSigningMiddlewareOptions,Ae as isIdentityExpired,He as memoizeIdentityProvider,Ce as normalizeProvider,Ne as requestBuilder};
//# sourceMappingURL=core.mjs.map