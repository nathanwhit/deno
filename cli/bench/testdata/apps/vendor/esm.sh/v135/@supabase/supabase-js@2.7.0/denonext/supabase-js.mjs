/* esm.sh - esbuild bundle(@supabase/supabase-js@2.7.0) denonext production */
import{FunctionsClient as D}from"/v135/@supabase/functions-js@2.1.5/denonext/functions-js.mjs";import{PostgrestClient as L}from"/v135/@supabase/postgrest-js@1.9.0/denonext/postgrest-js.mjs";import{RealtimeClient as j}from"/v135/@supabase/realtime-js@2.8.4/denonext/realtime-js.mjs";import{StorageClient as I}from"/v135/@supabase/storage-js@2.5.4/denonext/storage-js.mjs";var g="2.7.0";var x={"X-Client-Info":`supabase-js/${g}`};import S,{Headers as y}from"/v135/cross-fetch@3.1.8/denonext/cross-fetch.mjs";var E=function(o,t,e,s){function h(n){return n instanceof e?n:new e(function(i){i(n)})}return new(e||(e=Promise))(function(n,i){function l(a){try{r(s.next(a))}catch(u){i(u)}}function c(a){try{r(s.throw(a))}catch(u){i(u)}}function r(a){a.done?n(a.value):h(a.value).then(l,c)}r((s=s.apply(o,t||[])).next())})},U=o=>{let t;return o?t=o:typeof fetch>"u"?t=S:t=fetch,(...e)=>t(...e)},w=()=>typeof Headers>"u"?y:Headers,v=(o,t,e)=>{let s=U(e),h=w();return(n,i)=>E(void 0,void 0,void 0,function*(){var l;let c=(l=yield t())!==null&&l!==void 0?l:o,r=new h(i?.headers);return r.has("apikey")||r.set("apikey",o),r.has("Authorization")||r.set("Authorization",`Bearer ${c}`),s(n,Object.assign(Object.assign({},i),{headers:r}))})};function b(o){return o.replace(/\/$/,"")}function O(o,t){let{db:e,auth:s,realtime:h,global:n}=o,{db:i,auth:l,realtime:c,global:r}=t;return{db:Object.assign(Object.assign({},i),e),auth:Object.assign(Object.assign({},l),s),realtime:Object.assign(Object.assign({},c),h),global:Object.assign(Object.assign({},r),n)}}import{GoTrueClient as C}from"/v135/@supabase/gotrue-js@2.57.0/denonext/gotrue-js.mjs";var m=class extends C{constructor(t){super(t)}};var F=function(o,t,e,s){function h(n){return n instanceof e?n:new e(function(i){i(n)})}return new(e||(e=Promise))(function(n,i){function l(a){try{r(s.next(a))}catch(u){i(u)}}function c(a){try{r(s.throw(a))}catch(u){i(u)}}function r(a){a.done?n(a.value):h(a.value).then(l,c)}r((s=s.apply(o,t||[])).next())})},H={headers:x},R={schema:"public"},$={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},k={},p=class{constructor(t,e,s){var h,n,i,l,c,r,a,u;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let d=b(t);if(this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,d.match(/(supabase\.co)|(supabase\.in)/)){let _=d.split(".");this.functionsUrl=`${_[0]}.functions.${_[1]}.${_[2]}`}else this.functionsUrl=`${d}/functions/v1`;let T=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,A={db:R,realtime:k,auth:Object.assign(Object.assign({},$),{storageKey:T}),global:H},f=O(s??{},A);this.storageKey=(n=(h=f.auth)===null||h===void 0?void 0:h.storageKey)!==null&&n!==void 0?n:"",this.headers=(l=(i=f.global)===null||i===void 0?void 0:i.headers)!==null&&l!==void 0?l:{},this.auth=this._initSupabaseAuthClient((c=f.auth)!==null&&c!==void 0?c:{},this.headers,(r=f.global)===null||r===void 0?void 0:r.fetch),this.fetch=v(e,this._getAccessToken.bind(this),(a=f.global)===null||a===void 0?void 0:a.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new L(`${d}/rest/v1`,{headers:this.headers,schema:(u=f.db)===null||u===void 0?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new D(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new I(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}rpc(t,e={},s){return this.rest.rpc(t,e,s)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e;return F(this,void 0,void 0,function*(){let{data:s}=yield this.auth.getSession();return(e=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:s,storage:h,storageKey:n},i,l){let c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new m({url:this.authUrl,headers:Object.assign(Object.assign({},c),i),storageKey:n,autoRefreshToken:t,persistSession:e,detectSessionInUrl:s,storage:h,fetch:l})}_initRealtimeClient(t){var e;let s=(e=t.headers)===null||e===void 0?void 0:e.Authorization,h=s?.startsWith("Bearer ")&&s.split(" ")[1];return new j(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:h||this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,s)=>{this._handleTokenChanged(e,s?.access_token,"CLIENT")})}_handleTokenChanged(t,e,s){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==e?(this.realtime.setAuth(e??null),this.changedAccessToken=e):(t==="SIGNED_OUT"||t==="USER_DELETED")&&(this.realtime.setAuth(this.supabaseKey),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};export*from"/v135/@supabase/gotrue-js@2.57.0/denonext/gotrue-js.mjs";import{FunctionsHttpError as ht,FunctionsFetchError as lt,FunctionsRelayError as ct,FunctionsError as ut}from"/v135/@supabase/functions-js@2.1.5/denonext/functions-js.mjs";export*from"/v135/@supabase/realtime-js@2.8.4/denonext/realtime-js.mjs";var nt=(o,t,e)=>new p(o,t,e);export{ut as FunctionsError,lt as FunctionsFetchError,ht as FunctionsHttpError,ct as FunctionsRelayError,p as SupabaseClient,nt as createClient};
//# sourceMappingURL=supabase-js.mjs.map