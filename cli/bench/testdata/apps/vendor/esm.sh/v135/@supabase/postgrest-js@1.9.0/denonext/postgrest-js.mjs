/* esm.sh - esbuild bundle(@supabase/postgrest-js@1.9.0) denonext production */
import O from"/v135/@supabase/node-fetch@2.6.14/denonext/node-fetch.mjs";var u=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=O:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let i=this.fetch,r=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async t=>{var h,a,l;let n=null,o=null,A=null,m=t.status,P=t.statusText;if(t.ok){if(this.method!=="HEAD"){let y=await t.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?o=y:o=JSON.parse(y))}let $=(h=this.headers.Prefer)===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),g=(a=t.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");$&&g&&g.length>1&&(A=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(o)&&(o.length>1?(n={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,A=null,m=406,P="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{let $=await t.text();try{n=JSON.parse($),Array.isArray(n)&&t.status===404&&(o=[],n=null,m=200,P="OK")}catch{t.status===404&&$===""?(m=204,P="No Content"):n={message:$}}if(n&&this.isMaybeSingle&&(!((l=n?.details)===null||l===void 0)&&l.includes("0 rows"))&&(n=null,m=200,P="OK"),n&&this.shouldThrowOnError)throw n}return{error:n,data:o,count:A,status:m,statusText:P}});return this.shouldThrowOnError||(r=r.catch(t=>{var h,a,l;return{error:{message:`${(h=t?.name)!==null&&h!==void 0?h:"FetchError"}: ${t?.message}`,details:`${(a=t?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=t?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,s)}};var d=class extends u{select(e){let s=!1,i=(e??"*").split("").map(r=>/\s/.test(r)&&!s?"":(r==='"'&&(s=!s),r)).join("");return this.url.searchParams.set("select",i),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:s=!0,nullsFirst:i,foreignTable:r,referencedTable:t=r}={}){let h=t?`${t}.order`:"order",a=this.url.searchParams.get(h);return this.url.searchParams.set(h,`${a?`${a},`:""}${e}.${s?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:s,referencedTable:i=s}={}){let r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,s,{foreignTable:i,referencedTable:r=i}={}){let t=typeof r>"u"?"offset":`${r}.offset`,h=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(t,`${e}`),this.url.searchParams.set(h,`${s-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:s=!1,settings:i=!1,buffers:r=!1,wal:t=!1,format:h="text"}={}){var a;let l=[e?"analyze":null,s?"verbose":null,i?"settings":null,r?"buffers":null,t?"wal":null].filter(Boolean).join("|"),n=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${h}; for="${n}"; options=${l};`,h==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};var c=class extends d{eq(e,s){return this.url.searchParams.append(e,`eq.${s}`),this}neq(e,s){return this.url.searchParams.append(e,`neq.${s}`),this}gt(e,s){return this.url.searchParams.append(e,`gt.${s}`),this}gte(e,s){return this.url.searchParams.append(e,`gte.${s}`),this}lt(e,s){return this.url.searchParams.append(e,`lt.${s}`),this}lte(e,s){return this.url.searchParams.append(e,`lte.${s}`),this}like(e,s){return this.url.searchParams.append(e,`like.${s}`),this}likeAllOf(e,s){return this.url.searchParams.append(e,`like(all).{${s.join(",")}}`),this}likeAnyOf(e,s){return this.url.searchParams.append(e,`like(any).{${s.join(",")}}`),this}ilike(e,s){return this.url.searchParams.append(e,`ilike.${s}`),this}ilikeAllOf(e,s){return this.url.searchParams.append(e,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(e,s){return this.url.searchParams.append(e,`ilike(any).{${s.join(",")}}`),this}is(e,s){return this.url.searchParams.append(e,`is.${s}`),this}in(e,s){let i=s.map(r=>typeof r=="string"&&new RegExp("[,()]").test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${i})`),this}contains(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cs.{${s.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(s)}`),this}containedBy(e,s){return typeof s=="string"?this.url.searchParams.append(e,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(e,`cd.{${s.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(s)}`),this}rangeGt(e,s){return this.url.searchParams.append(e,`sr.${s}`),this}rangeGte(e,s){return this.url.searchParams.append(e,`nxl.${s}`),this}rangeLt(e,s){return this.url.searchParams.append(e,`sl.${s}`),this}rangeLte(e,s){return this.url.searchParams.append(e,`nxr.${s}`),this}rangeAdjacent(e,s){return this.url.searchParams.append(e,`adj.${s}`),this}overlaps(e,s){return typeof s=="string"?this.url.searchParams.append(e,`ov.${s}`):this.url.searchParams.append(e,`ov.{${s.join(",")}}`),this}textSearch(e,s,{config:i,type:r}={}){let t="";r==="plain"?t="pl":r==="phrase"?t="ph":r==="websearch"&&(t="w");let h=i===void 0?"":`(${i})`;return this.url.searchParams.append(e,`${t}fts${h}.${s}`),this}match(e){return Object.entries(e).forEach(([s,i])=>{this.url.searchParams.append(s,`eq.${i}`)}),this}not(e,s,i){return this.url.searchParams.append(e,`not.${s}.${i}`),this}or(e,{foreignTable:s,referencedTable:i=s}={}){let r=i?`${i}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,s,i){return this.url.searchParams.append(e,`${s}.${i}`),this}};var p=class{constructor(e,{headers:s={},schema:i,fetch:r}){this.url=e,this.headers=s,this.schema=i,this.fetch=r}select(e,{head:s=!1,count:i}={}){let r=s?"HEAD":"GET",t=!1,h=(e??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",h),i&&(this.headers.Prefer=`count=${i}`),new c({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:s,defaultToNull:i=!0}={}){let r="POST",t=[];if(this.headers.Prefer&&t.push(this.headers.Prefer),s&&t.push(`count=${s}`),i||t.push("missing=default"),this.headers.Prefer=t.join(","),Array.isArray(e)){let h=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(h.length>0){let a=[...new Set(h)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new c({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:s,ignoreDuplicates:i=!1,count:r,defaultToNull:t=!0}={}){let h="POST",a=[`resolution=${i?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&a.push(this.headers.Prefer),r&&a.push(`count=${r}`),t||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){let l=e.reduce((n,o)=>n.concat(Object.keys(o)),[]);if(l.length>0){let n=[...new Set(l)].map(o=>`"${o}"`);this.url.searchParams.set("columns",n.join(","))}}return new c({method:h,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:s}={}){let i="PATCH",r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),s&&r.push(`count=${s}`),this.headers.Prefer=r.join(","),new c({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){let s="DELETE",i=[];return e&&i.push(`count=${e}`),this.headers.Prefer&&i.unshift(this.headers.Prefer),this.headers.Prefer=i.join(","),new c({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var w="1.9.0";var x={"X-Client-Info":`postgrest-js/${w}`};var j=class f{constructor(e,{headers:s={},schema:i,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},x),s),this.schemaName=i,this.fetch=r}from(e){let s=new URL(`${this.url}/${e}`);return new p(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new f(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,s={},{head:i=!1,count:r}={}){let t,h=new URL(`${this.url}/rpc/${e}`),a;i?(t="HEAD",Object.entries(s).forEach(([n,o])=>{h.searchParams.append(n,`${o}`)})):(t="POST",a=s);let l=Object.assign({},this.headers);return r&&(l.Prefer=`count=${r}`),new c({method:t,url:h,headers:l,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};export{u as PostgrestBuilder,j as PostgrestClient,c as PostgrestFilterBuilder,p as PostgrestQueryBuilder,d as PostgrestTransformBuilder};
//# sourceMappingURL=postgrest-js.mjs.map